# 솔라피 알림톡 연동 문서

> 작성일: 2026.02.22 | 상태: 템플릿 검수진행중

---

## 계정 정보

| 항목 | 값 |
|------|-----|
| API KEY | NCSDAF4CTQVUKJAX |
| PF_ID | KA01PF2602181223374948VgQEw1w3yH |
| 발신번호 | 18991871 |
| 카카오채널 | 미스터팍 |

> API SECRET은 솔라피 콘솔에서 확인 (코드에는 환경변수로 관리)

---

## 환경변수 (Vercel)

```env
SOLAPI_API_KEY=NCSDAF4CTQVUKJAX
SOLAPI_API_SECRET=EH30CUBFLK0FGBLHFPGVYPINY3SX5K4H
SOLAPI_PF_ID=KA01PF2602181223374948VgQEw1w3yH
SOLAPI_SENDER_NUMBER=18991871
```

---

## 알림톡 템플릿 목록

| 순번 | 템플릿명 | 발송 시점 | 상태 | 템플릿 ID |
|------|---------|-----------|------|-----------|
| 1 | 입차확인 | 입차 등록 직후 | 검수진행중 | - |
| 2 | 차량준비완료 | 발렛 차량 준비 완료 시 | 검수진행중 | - |
| 3 | 팀원초대 | 관리자가 팀원 초대 시 | 검수진행중 | - |
| 4 | 월주차만기D7 | 만기 7일 전 오전 10:00 (자동 + 수동) | 검수진행중 | - |
| 5 | 월주차만료안내 | 만료 다음날 오전 09:00 | 검수진행중 | - |
| 6 | 월주차연장완료 | 결제 완료 즉시 | 검수진행중 | - |

> ✅ 검수 승인 후 템플릿 ID 칼럼 업데이트 필요

---

## 템플릿 내용

### 1. 입차확인

```
[미팍Ticket] 입차 완료

#{매장명} 주차장에 입차되었습니다.

■ 차량번호: #{차량번호}
■ 입차시간: #{입차시간}
■ 주차요금: #{요금안내}

주차요금 사전정산 및 출차 안내는
아래 버튼을 통해 확인하세요.
```

버튼: 링크 / `주차현황 확인` / `https://mrpark-parking.vercel.app/ticket/#{티켓ID}`

변수: `#{매장명}` `#{차량번호}` `#{입차시간}` `#{요금안내}` `#{티켓ID}`

---

### 2. 차량준비완료

```
[미팍Ticket] 차량 준비 완료

#{차량번호} 차량이 출구에 준비되었습니다.

■ 대기 위치: #{출구위치}
■ 준비완료: #{준비시간}

지금 바로 출차 가능합니다 🚗
```

버튼: 링크 / `티켓 확인` / `https://mrpark-parking.vercel.app/ticket/#{티켓ID}`

변수: `#{차량번호}` `#{출구위치}` `#{준비시간}` `#{티켓ID}`

---

### 3. 팀원초대

```
[미팍Ticket] 팀원 초대

안녕하세요, #{이름}님!

#{초대자}님이 #{매장명} 팀에
초대하였습니다.

아래 버튼을 눌러 초대를 수락하고
미팍Ticket을 시작하세요 🅿️
```

버튼: 링크 / `초대 수락하기` / `https://mrpark-parking.vercel.app/invite/#{초대코드}`

변수: `#{이름}` `#{초대자}` `#{매장명}` `#{초대코드}`

---

### 4. 월주차만기D7

```
[미팍Ticket] 월주차 만기 예정 안내

안녕하세요, #{고객명}님! 🚗

#{매장명} 월주차 계약이
곧 만료될 예정입니다.

■ 차량번호: #{차량번호}
■ 계약기간: #{시작일} ~ #{만료일}
■ 월 요금: #{월요금}원

만기일 이후에는 재신청이 어려울 수 있으니
아래 버튼으로 간편하게 연장해 주세요 !

자세한 사항은 이용중인 주차장을 통해
확인해 주세요 😊
```

버튼: 링크 / `지금 연장하기` / `https://mrpark-parking.vercel.app/monthly/renew/#{연장토큰}`

변수: `#{고객명}` `#{매장명}` `#{차량번호}` `#{시작일}` `#{만료일}` `#{월요금}` `#{연장토큰}`

> 📌 발송 정책: D-7 1회 자동발송 + 관리자 수동발송 가능 (동일 템플릿 재사용)

---

### 5. 월주차만료안내

```
[미팍Ticket] 월주차 만료 안내

안녕하세요, #{고객명}님.

#{차량번호} 월주차 계약이
#{만료일}에 만료되었습니다.

입차가 불가하거나 일반주차요금이
적용될 수 있습니다.

재계약을 원하시면 이용중인 주차장으로
문의해 주세요. 감사합니다 🙏
```

버튼: 없음

변수: `#{고객명}` `#{차량번호}` `#{만료일}`

---

### 6. 월주차연장완료

```
[미팍Ticket] 월주차 연장 결제 완료

안녕하세요, #{고객명}님! ✅

월주차 연장 결제가 완료되었습니다.

■ 차량번호: #{차량번호}
■ 매장명: #{매장명}
■ 결제금액: #{결제금액}원
■ 갱신기간: #{시작일} ~ #{만료일}

이용해 주셔서 감사합니다 🚗
```

버튼: 없음

변수: `#{고객명}` `#{차량번호}` `#{매장명}` `#{결제금액}` `#{시작일}` `#{만료일}`

---

## 발송 정책

### 미팍티켓 (전자주차권)

| 시점 | 템플릿 | 전화번호 처리 |
|------|--------|-------------|
| 입차 완료 | 입차확인 | 발송 후 즉시 삭제 (DB 미저장) |
| 발렛 차량 준비 완료 | 차량준비완료 | 재입력 후 즉시 삭제 |

> ⚠️ 전화번호는 절대 DB에 저장하지 않음. 로그는 010****1234 형태로 마스킹.

### 월주차

| 시점 | 템플릿 | 방식 |
|------|--------|------|
| 만기 D-7 오전 10:00 | 월주차만기D7 | 자동 (Supabase Cron) |
| 관리자 수동 발송 | 월주차만기D7 | 수동 (관리자 웹 버튼) |
| 만료 다음날 09:00 | 월주차만료안내 | 자동 (Supabase Cron) |
| 결제 완료 즉시 | 월주차연장완료 | 자동 (결제 API 트리거) |

### 시스템

| 시점 | 템플릿 | 방식 |
|------|--------|------|
| 팀원 초대 시 | 팀원초대 | 수동 (관리자 트리거) |

---

## 개발 연동 (예정)

```typescript
// src/lib/solapi.ts
import SolapiMessageService from "solapi";

const messageService = new SolapiMessageService(
  process.env.SOLAPI_API_KEY!,
  process.env.SOLAPI_API_SECRET!
);

// 템플릿 ID (검수 승인 후 업데이트)
const TEMPLATE_IDS = {
  ENTRY:           "", // 입차확인
  CAR_READY:       "", // 차량준비완료
  TEAM_INVITE:     "", // 팀원초대
  MONTHLY_D7:      "", // 월주차만기D7
  MONTHLY_EXPIRED: "", // 월주차만료안내
  MONTHLY_RENEWED: "", // 월주차연장완료
};
```

> 검수 승인 후 각 templateId 입력 및 함수 구현 필요
