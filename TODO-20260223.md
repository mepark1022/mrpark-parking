# 📋 2026.2.23 (일) TODO — 코드 실검증 기반

> 기준: GitHub 실제 코드 분석 + 커밋 히스토리 검증 (2026.2.23)

---

## ✅ 완료 확인된 작업

### 어드민 v3 디자인 (11페이지 전체)
| 페이지 | v3 디자인 | 모바일 | Supabase 연동 |
|--------|-----------|--------|---------------|
| /dashboard | ✅ | ✅ | ✅ (parking_lots, daily_records, hourly_data) |
| /entry | ✅ | ✅ | ✅ |
| /parking-status | ✅ | ✅ | ✅ |
| /monthly | ✅ | ✅ | ✅ |
| /analytics | ✅ | ✅ | ✅ |
| /workers | ✅ | ✅ | ✅ (공휴일/주말 집계, 엑셀 다운로드) |
| /stores | ✅ | ✅ | ✅ |
| /team | ✅ | ✅ | ✅ |
| /accident | ✅ | ✅ | ❌ **더미데이터 (DB 미연동)** |
| /settings | ✅ | ✅ | ✅ |
| /guide | ✅ | ✅ | — (정적) |
| /login | ✅ | ✅ | ✅ |

---

## 🔴 미완료 — 즉시 처리 필요

### 1순위: Supabase SQL 직접 실행 (대표님 직접)
> Supabase 대시보드 → SQL Editor에서 실행

```sql
-- parking_lots org_id 채우기 (대시보드 주차장 현황 표시 필수)
UPDATE parking_lots pl
SET org_id = s.org_id
FROM stores s
WHERE pl.store_id = s.id
AND pl.org_id IS NULL;

-- 근태 공휴일 분류용 컬럼 (근무자 공휴일 집계 필수)
ALTER TABLE daily_records ADD COLUMN IF NOT EXISTS day_type text DEFAULT 'weekday';
ALTER TABLE daily_records ADD COLUMN IF NOT EXISTS is_holiday boolean DEFAULT false;
```

### 2순위: 사고보고 DB 연동
- 현재 `SAMPLE_ACCIDENTS` 더미 데이터 사용 중 (`src/app/accident/page.tsx:86`)
- Supabase `accidents` 테이블 연동 필요
- 등록/조회/상태변경 실제 DB 처리

---

## 🟡 백로그 — 미팍티켓 기능

| 기능 | 상태 | 비고 |
|------|------|------|
| 고객 화면 프로토타입 | ✅ 완료 | 6가지 상태 시뮬레이터 |
| 전자티켓 QR 생성 로직 | ❌ 미구현 | — |
| 알림톡 발송 (입차/정산) | ❌ 미구현 | 아래 상세 참조 |
| Toss Payments 결제 연동 | ❌ 미구현 | — |
| 크루앱 (모바일 전용 UI) | ❌ 미구현 | 별도 앱/페이지 |

---

## 📦 배포 정보

| 항목 | 내용 |
|------|------|
| GitHub | https://github.com/mepark1022/mrpark-parking |
| Vercel | https://mrpark-parking.vercel.app |
| 최근 커밋 | docs: 구 TODO 파일 삭제 (2026.2.23) |
| PAT 만료 | ghp_******* (만료일 미확인, 요청 시 재발급) |


---

## 🟠 나중에 할 일 — 솔라피 알림톡 연동

> 발송 정책: **2회** (입차 완료 + 정산 완료) / 전화번호 DB 미저장 원칙

### Step 1: 솔라피 카카오채널 연결 → PF_ID 확보
- [ ] 솔라피 콘솔 → 채널 → 카카오톡 채널 등록
- [ ] 미스터팍 카카오 비즈니스 채널 연동
- [ ] SOLAPI_PF_ID 값 확인 후 Vercel 환경변수에 추가

### Step 2: 알림톡 템플릿 2종 카카오 검수 신청 (1~3 영업일)
- [ ] 템플릿 A: 입차 완료 알림 (변수: 차량번호, 매장명, 입차시간, 주차위치, 티켓URL)
- [ ] 템플릿 B: 정산 완료 알림 (변수: 차량번호, 결제금액, 유예시간)
- [ ] 검수 승인 후 templateId 기록

### Step 3: 코드 작업
- [ ] npm install solapi
- [ ] /src/lib/solapi.ts 생성 (sendEntryAlimtalk, sendPaymentAlimtalk 함수)
- [ ] 전화번호 로그 마스킹 처리 (010****1234)
- [ ] /api/ticket/entry 에서 입차 알림톡 호출
- [ ] /api/payment/confirm 에서 정산완료 알림톡 호출

### Step 4: Vercel 환경변수 업데이트
```
SOLAPI_API_KEY=NCSDAF4CTQVUKJAX
SOLAPI_API_SECRET=EH30CUBFLK0FGBLHFPGVYPINY3SX5K4H
SOLAPI_PF_ID=          ← Step 1 완료 후 입력
SOLAPI_SENDER_NUMBER=18991871
```

> ⚠️ 선행 조건: 카카오 비즈니스 채널 미개설 시 채널 개설 먼저 진행
