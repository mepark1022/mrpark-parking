# 📋 2026.2.24 (월) TODO — 최신화

> 기준: 2026.2.24 어드민 수정 기획 완료 후 업데이트

---

## 🆕 2026.2.23 완료

### mrpark-system.md 업데이트
- [x] Part 12: CREW 앱 기획 확정 추가
- [x] Part 13: 어드민 수정 기획 상세 추가 (8개 항목)

### Part 13 어드민 수정 기획 (P0/P1)

> ✅ 13.3 알림 설정 확인 완료 (2026.2.23): /settings 페이지에 미팍티켓 알림 설정 UI + DB(user_notification_settings) 연동 완전 구현 확인. 역할별 권한 분기(CREW 필수수신, Admin ON/OFF, 전체 OFF) 포함.

> ✅ 13.8 근태 미출퇴근 집계 UI 확인 완료 (2026.2.24): /workers 근태 탭에 월간 요약 카드 6종(정상/지각/결근(미출근)/미퇴근/휴무/연차), 개인별 미출퇴근 테이블+보기 모달, 매트릭스 셀 미퇴근(⚠) 표시, 엑셀 3시트(요약+미출근상세+미퇴근상세) 완전 구현 확인.


| Part | 항목 | 우선순위 | 상태 |
|------|------|----------|------|
| 13.1 | 매장 설정 토글 (5개 필드) | P0 | ✅ 완료 (2026.2.24) |
| 13.2 | 권한 관리 시스템 (3단계) | P0 | ✅ 완료 (2026.2.23) |
| 13.3 | 알림 설정 (3종류 × 3방식) | P0 | ✅ 완료 (2026.2.23) |
| 13.4 | 매장 선택 화면 | P0 | ⏳ 크루앱 개발 시 구현 |
| 13.5 | 월주차 만료 처리 | P1 | ✅ 완료 (2026.2.23) |
| 13.5-DB | 입차현황 초과 처리 (mepark_tickets 테이블) | P1 | ✅ SQL 작성 완료 (2026.2.24) |
| 13.6 | 추가요금 결제 (유예시간 초과) | P1 | ✅ 완료 (2026.2.23) |
| 13.7 | 퇴근 처리 요청 승인 | P1 | ✅ 완료 (2026.2.24) |
| 13.8 | 근태 미출퇴근 집계 | P1 | ✅ 완료 (2026.2.24) |

> ✅ Part 13 전체 DB 완료 (2026.2.23): stores 9컬럼, profiles role, user_notification_settings, checkout_requests, worker_attendance 타입 컬럼

---

## ✅ 완료 확인된 작업

### 어드민 v3 디자인 (11페이지 전체)
| 페이지 | v3 디자인 | 모바일 | Supabase 연동 |
|--------|-----------|--------|---------------|
| /dashboard | ✅ | ✅ | ✅ |
| /entry | ✅ | ✅ | ✅ |
| /parking-status | ✅ | ✅ (v3 완료 2026.2.22) | ✅ |
| /monthly | ✅ | ✅ | ✅ |
| /analytics | ✅ | ✅ | ✅ |
| /workers | ✅ | ✅ | ✅ |
| /stores | ✅ | ✅ | ✅ |
| /team | ✅ | ✅ | ✅ |
| /accident | ✅ | ✅ | ❌ **더미데이터 (DB 미연동)** |
| /settings | ✅ | ✅ | ✅ |
| /guide | ✅ | ✅ | — (정적) |
| /login | ✅ | ✅ | ✅ |

### 2026.2.22 완료
- [x] 입차현황 모바일 v3: 미팍Ticket 로고, 플로우바(주차중→발렛→월주차→출차), 컴팩트 카드

---

## ✅ Part 14 진행 현황

### Part 14-A: DB 잔여 작업 ✅ 완료 (2026.2.23)
- ✅ parking_lots org_id 업데이트 완료
- ✅ daily_records day_type / is_holiday 컬럼 추가 완료
- ✅ stores contact_name / contact_phone / latitude / longitude 컬럼 추가 완료

## 🔴 미완료 — 즉시 처리 필요

### 2순위: 사고보고 DB 연동 ✅ 완료 (2026.2.23)
- 어드민 `accident_reports` 테이블 연동 완료 (조회/상태변경/메모/삭제/엑셀)
- 크루앱 안내 배너 추가 ("사고보고는 크루앱에서 등록" 명시)
- **사고 등록(Create)은 크루앱 개발 시 구현 예정**
- ✅ Supabase SQL 실행 완료 (2026.2.23): accident_reports 테이블 + RLS + accident-photos 버킷

---

## 🟡 백로그 — 미팍티켓 기능

| 기능 | 상태 | 비고 |
|------|------|------|
| 고객 화면 프로토타입 | ✅ 완료 | 6가지 상태 시뮬레이터 |
| 전자티켓 QR 생성 로직 | ❌ 미구현 | — |
| 알림톡 발송 (입차/정산) | ❌ 미구현 | 아래 상세 참조 |
| Toss Payments 결제 연동 | ❌ 미구현 | — |
| 크루앱 (모바일 전용 UI) | ❌ 미구현 | 별도 앱/페이지 |

---

## 📦 배포 정보

| 항목 | 내용 |
|------|------|
| GitHub | https://github.com/mepark1022/mrpark-parking |
| Vercel | https://mrpark-parking.vercel.app |
| 최근 커밋 | feat: 입차현황 모바일 v3 (2026.2.22) |
| PAT 만료 | ghp_******* (만료일 미확인, 요청 시 재발급) |

---

## 🟠 나중에 할 일 — 솔라피 알림톡 연동

> 발송 정책: **2회** (입차 완료 + 정산 완료) / 전화번호 DB 미저장 원칙

### Step 1: 솔라피 카카오채널 연결 → PF_ID 확보
- [ ] 솔라피 콘솔 → 채널 → 카카오톡 채널 등록
- [ ] 미스터팍 카카오 비즈니스 채널 연동
- [x] SOLAPI_PF_ID 값 확인 후 Vercel 환경변수에 추가

### Step 2: 알림톡 템플릿 2종 카카오 검수 신청 (1~3 영업일)
- [ ] 템플릿 A: 입차 완료 알림 (변수: 차량번호, 매장명, 입차시간, 주차위치, 티켓URL)
- [ ] 템플릿 B: 정산 완료 알림 (변수: 차량번호, 결제금액, 유예시간)
- [ ] 검수 승인 후 templateId 기록

### Step 3: 코드 작업
- [ ] npm install solapi
- [ ] /src/lib/solapi.ts 생성 (sendEntryAlimtalk, sendPaymentAlimtalk 함수)
- [ ] 전화번호 로그 마스킹 처리 (010****1234)
- [ ] /api/ticket/entry 에서 입차 알림톡 호출
- [ ] /api/payment/confirm 에서 정산완료 알림톡 호출

### Step 4: Vercel 환경변수 업데이트
```
SOLAPI_API_KEY=NCSDAF4CTQVUKJAX
SOLAPI_API_SECRET=EH30CUBFLK0FGBLHFPGVYPINY3SX5K4H
SOLAPI_PF_ID=KA01PF2602181223374948VgQEw1w3yH
SOLAPI_SENDER_NUMBER=18991871
```

> ⚠️ 선행 조건: 카카오 비즈니스 채널 미개설 시 채널 개설 먼저 진행
